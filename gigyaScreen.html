<html lang="en">

	<head>
		<title> Gigya test page</title>
	</head>

	<body>
		<main>
			<h1>Gigya Screen Set</h1>
			<div id='RAASLogin'></div>
		</main>
		<br>
		<div> <h1>Login status</h1> <span id='ai-login'> </span> </div>
		<div> <span id='ai-login.uid'> </span> </div>
		<h1>Gigya Social UI</h1>
		<div id='SocialUI'></div>
		
		<h1>Gigya Add connection UI</h1>
		<div id='AddConnection'></div>
		
		<h1>Gigya Edit connection UI</h1>
		<div id='EditConnection'></div>

		
		<script>
		
			function onLoginEvent(e){
				if (e.UID){
					console.log("onLoginEvent");
					document.getElementById('ai-login').innerHTML = "Logged In";
					document.getElementById('ai-login.uid').innerHTML = `UID: ${e.UID}`;
				}
				else{
					document.getElementById('ai-login').innerHTML = "Logged out";
				}
			}
			
			function onLogoutEvent(e){
				document.getElementById('ai-login').innerHTML = "Logged out";
				document.getElementById('ai-login.uid').innerHTML = "";
			}
		
			function getQueryVariable(variable) {
				var query = window.location.search.substring(1);
				var vars = query.split('&');
				for (var i = 0; i < vars.length; i++) {
					var pair = vars[i].split('=');
					if (decodeURIComponent(pair[0]) == variable) {
						return decodeURIComponent(pair[1]);
					}
				}					
			}
			
			const apiKey = getQueryVariable('apiKey');
			const screenSet = getQueryVariable('screenSet');
			const startScreen = getQueryVariable('startScreen');
			const lang = getQueryVariable('lang');
			
		
			let gigyaSrc = document.createElement("script");
			gigyaSrc.setAttribute("src", `https://cdns.us1.gigya.com/js/gigya.js?apiKey=${apiKey}`);
			document.body.appendChild(gigyaSrc);
		
			const params = {
				containerID: `RAASLogin`,
				screenSet: screenSet,
				startScreen: startScreen,
				lang: lang
			}  

			onGigyaServiceReady = function () {
				gigya.accounts.showScreenSet(params);
				gigya.accounts.addEventHandlers({
				 onLogin: onLoginEvent,
				 onLogout: onLogoutEvent
				});
				gigya.accounts.getAccountInfo({
					callback: function (cb) {
					onLoginEvent(cb);
					}
				});
				gigya.socialize.showLoginUI({
					containerID: 'SocialUI'
				});
				gigya.socialize.showAddConnectionsUI({
					containerID: 'AddConnection'
				});
				gigya.socialize.showEditConnectionsUI({
					containerID: 'EditConnection'
				});
			};		
			
		</script>
		
	</body>

</html>